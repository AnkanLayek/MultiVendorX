!function(e,i,t,n){e(function(){var t=t||{build:function(){this.init(),this.bindEvents()},init:function(){this.shipping_zone_table=".mvx-shipping-zones",this.table_shipping_zone_settings=".mvx-shipping-zone-settings",this.table_shipping_zone_methods=".mvx-shipping-zone-methods",this.modify_shipping_methods=".modify-shipping-methods",this.modal_add_shipping_method=".mvx-modal-add-shipping-method-modal",this.show_shipping_methods=this.table_shipping_zone_settings+" .mvx-shipping-zone-show-method",this.add_shipping_methods=this.modal_add_shipping_method+" .mvx-shipping-zone-add-method",this.edit_shipping_methods=this.table_shipping_zone_settings+" .edit-shipping-method",this.delete_shipping_method=this.table_shipping_zone_settings+" .delete-shipping-method",this.method_status=this.table_shipping_zone_methods+" .method-status",this.limit_zone_location=this.table_shipping_zone_settings+" #limit_zone_location"},bindEvents:function(){e(this.modify_shipping_methods).on("click",this.modify_shipping_methods_admin.bind(this)),e(document).on("zone_settings_loaded",this.zoneLoadedEvents.bind(this)),e(document.body).on("click",this.show_shipping_methods,this.showShippingMethods),e(document.body).on("wc_backbone_modal_response",this.addShippingMethod),e(document.body).on("wc_backbone_modal_response",this.updateShippingMethod),e(document.body).on("click",this.edit_shipping_methods,this.editShippingMethod),e(document.body).on("click",this.delete_shipping_method,this.deleteShippingMethod),e(document.body).on("change",this.method_status,this.toggleShippingMethod),e(document.body).on("change",this.limit_zone_location,this.limitZoneLocation),e(document.body).on("change",".wc-shipping-zone-method-selector select",this.onChangeShippingMethodSelector),this.limitZoneLocation()},modify_shipping_methods_admin:function(i,t){var n=this;e(".mvx-shipping-zones").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),void 0!==i&&(i.preventDefault(),t=e(i.currentTarget).data("zoneId"),vendor_id=e(i.currentTarget).data("vendor_id"));e.ajax({method:"post",url:mvx_vendor_shipping_script_data.ajaxurl,data:{action:"admin-get-vendor-shipping-methods-by-zone",zoneID:t,vendor_id:vendor_id},success:function(i){e(n.table_shipping_zone_settings).html(i).show(),e(n.shipping_zone_table).hide()},complete:function(){e(".mvx-shipping-zones").unblock(),e(document).trigger("zone_settings_loaded")}})},zoneLoadedEvents:function(e){this.limitZoneLocation(e)},showShippingMethods:function(i){i.preventDefault();var t=e("#zone_id").val();e(this).WCBackboneModal({template:"mvx-modal-add-shipping-method",variable:{zone_id:t}}),e(".wc-shipping-zone-method-selector select").change()},onChangeShippingMethodSelector:function(){var i=e(this).find("option:selected").data("description");e(this).parent().find(".wc-shipping-zone-method-description").remove(),e(this).after('<div class="wc-shipping-zone-method-description">'+i+"</div>"),e(this).closest("article").height(e(this).parent().height())},addShippingMethod:function(i,t,o){if("mvx-modal-add-shipping-method"===t){i.preventDefault();var d=o.zone_id,s=o.vendor_id,a=o.mvx_shipping_method;if(""==d);else if(""==a);else{var h={action:"mvx-add-shipping-method",zoneID:d,method:a,vendor_id:s};e(this.add_shipping_methods).block({message:null,overlayCSS:{background:"#fff",opacity:.6}});e.ajax({method:"post",url:n,data:h,success:function(i){if(i.success)if(s)e.ajax({method:"post",url:mvx_vendor_shipping_script_data.ajaxurl,data:{action:"admin-get-vendor-shipping-methods-by-zone",zoneID:d,vendor_id:s},success:function(i){e(".mvx-shipping-zone-settings").html(i).show(),e(document).trigger("zone_settings_loaded")}});else location.reload()}})}}},editShippingMethod:function(i){i.preventDefault(),e(".mvx-shipping-zone-methods").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var t=e(i.currentTarget).data("instance_id"),o=e(i.currentTarget).data("method_id"),d=e(i.currentTarget).data("zone_id"),s=e(i.currentTarget).data("vendor_id"),a={action:"mvx-configure-shipping-method",zoneId:d,instanceId:t,methodId:o,vendor_id:s};e("#method_id_selected").val(o),e("#instance_id_selected").val(t);e.ajax({method:"post",url:n,data:a,success:function(i){i&&(e(".mvx-shipping-zone-methods").unblock(),e(this).WCBackboneModal({template:"mvx-modal-update-shipping-method",variable:{methodId:o,instanceId:t,config_settings:i}}))}})},updateShippingMethod:function(i,t,o){if("mvx-modal-update-shipping-method"===t){i.preventDefault();var d=o.method_id,s=o.instance_id,a=o.zone_id,h=o.vendor_id,p={action:"mvx-update-shipping-method",zoneID:a,posted_data:o,args:{instance_id:s,zone_id:a,method_id:d,vendor_id:h,settings:{}}};e.ajax({method:"post",url:n,data:p,success:function(i){if(i.success)if(h)e.ajax({method:"post",url:mvx_vendor_shipping_script_data.ajaxurl,data:{action:"admin-get-vendor-shipping-methods-by-zone",zoneID:a,vendor_id:h},success:function(i){e(".mvx-shipping-zone-settings").html(i).show(),e(document).trigger("zone_settings_loaded")}});else location.reload();else alert(i.data)}})}},deleteShippingMethod:function(t){t.preventDefault();if(confirm(i.i18n.deleteShippingMethodConfirmation)){e(t.target).is(this.delete_shipping_method)?t.target:e(t.target).closest(this.delete_shipping_method);var o=e(t.currentTarget).data("vendor_id"),d=e(t.target).attr("data-instance_id"),s=e("#zone_id").val(),a=a={action:"mvx-delete-shipping-method",zoneID:s,instance_id:d,vendor_id:o};if(""==s);else if(""==d);else e.ajax({method:"post",url:n,data:a,success:function(i){if(i.success)if(o)e.ajax({method:"post",url:mvx_vendor_shipping_script_data.ajaxurl,data:{action:"admin-get-vendor-shipping-methods-by-zone",zoneID:s,vendor_id:o},success:function(i){e(".mvx-shipping-zone-settings").html(i).show(),e(document).trigger("zone_settings_loaded")}});else location.reload();else alert(resp.data)}})}},limitZoneLocation:function(i){e("#limit_zone_location").is(":checked")?(e(".hide_if_zone_not_limited").show(),e("#select_zone_states").select2()):e(".hide_if_zone_not_limited").hide()},toggleShippingMethod:function(i){i.preventDefault();var t=e(i.target).is(":checked"),n=e(i.target).val(),o=e(i.currentTarget).data("vendor_id"),d=e("#zone_id").val(),s={action:"mvx-toggle-shipping-method",zoneID:d,instance_id:n,checked:t,vendor_id:o};if(""==d);else if(""==n);else{e(".mvx-container").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});e.ajax({method:"post",url:mvx_vendor_shipping_script_data.ajaxurl,data:s,success:function(i){i.success?e(".mvx-container").unblock():(e(".mvx-container").unblock(),alert(i.data))}})}}};e(t.build.bind(t))})}(jQuery,mvx_vendor_shipping_script_data,wp,ajaxurl);
